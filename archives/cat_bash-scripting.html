<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
   <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
   
      
      
   
      
      
   
      
      
   
   <title>Embracing the Challenges of Technology - Bash-Scripting</title>
   <link rel="apple-touch-icon" sizes="57x57" href="./../apple-touch-icon-57x57.png">
   <link rel="apple-touch-icon" sizes="60x60" href="./../apple-touch-icon-60x60.png">
   <link rel="apple-touch-icon" sizes="72x72" href="./../apple-touch-icon-72x72.png">
   <link rel="apple-touch-icon" sizes="76x76" href="./../apple-touch-icon-76x76.png">
   <link rel="apple-touch-icon" sizes="114x114" href="./../apple-touch-icon-114x114.png">
   <link rel="apple-touch-icon" sizes="120x120" href="./../apple-touch-icon-120x120.png">
   <link rel="apple-touch-icon" sizes="144x144" href="./../apple-touch-icon-144x144.png">
   <link rel="apple-touch-icon" sizes="152x152" href="./../apple-touch-icon-152x152.png">
   <link rel="apple-touch-icon" sizes="180x180" href="./../apple-touch-icon-180x180.png">
   <link rel="icon" type="image/png" href="./../favicon-32x32.png" sizes="32x32">
   <link rel="icon" type="image/png" href="./../android-chrome-192x192.png" sizes="192x192">
   <link rel="icon" type="image/png" href="./../favicon-96x96.png" sizes="96x96">
   <link rel="icon" type="image/png" href="./../favicon-16x16.png" sizes="16x16">
   <link rel="icon" type="image/x-icon" href="./../favicon.ico" />
   <link rel="manifest" href="./../manifest.json">
   <link rel="mask-icon" href="./../safari-pinned-tab.svg" color="#5bbad5">
   <meta name="msapplication-TileColor" content="#da532c">
   <meta name="msapplication-TileImage" content="/mstile-144x144.png">
   <meta name="theme-color" content="#ffffff">
   <link rel="canonical" href="./../" />
   <link type="application/rss+xml" rel="alternate" title="RSS 2.0 - all posts" href="./.././rss.xml" />
   <link rel="me" href="https://plus.google.com/110121544309331268618" />
   <style type="text/css" media="screen">@import url( ./../css/style.css );</style>
   <script type="text/javascript" src="./../js/blog.js"></script>
</head>
<body id="category-template">
   <div id="page">
      <div id="header">
         <h1><a href="./.././index.html">Embracing the Challenges of Technology</a></h1>
         <h2></h2>
      </div>
      <div id="nav" class="border-shadow-yellow">
         <ul>
            <li><a href="./.././index.html" title="Home">Home</a></li>
            <li><a href="#">Recent Posts</a>
               <ul class="border-shadow-green fallback">
                  
                     <li><a href="./.././archives/preventing-the-same-script-from-running-at-the-same-time.html">Preventing the same script from running at the same time.</a></li>
                  
                     <li><a href="./.././archives/when-to-use-variables.html">When to use variables</a></li>
                  
                     <li><a href="./.././archives/running-scripts-as-cron-jobs.html">Running scripts as cron jobs</a></li>
                  
               </ul>
            </li>
            <li><a href="#">Category</a>
               <ul class="border-shadow-green fallback">
                  
                     <li><a href="./.././archives/cat_bash-scripting.html" title="Bash-Scripting">Bash-Scripting</a></li>
                  
                     <li><a href="./.././archives/cat_general.html" title="General">General</a></li>
                  
                     <li><a href="./.././archives/cat_haskell.html" title="Haskell">Haskell</a></li>
                  
                     <li><a href="./.././archives/cat_quotes.html" title="Quotes">Quotes</a></li>
                  
                     <li><a href="./.././archives/cat_rust.html" title="Rust">Rust</a></li>
                  
                     <li><a href="./.././archives/cat_softwaredesign.html" title="Software Design">Software Design</a></li>
                  
                     <li><a href="./.././archives/cat_softwaredevelopment.html" title="Software Development">Software Development</a></li>
                  
                     <li><a href="./.././archives/cat_softwaretesting.html" title="Software Testing">Software Testing</a></li>
                  
               </ul>
            </li>
            <li><a href="#">Archives</a>
               <ul class="border-shadow-green fallback">
                  
                     <li class="linear-gradient-green">2016</li>
                     
                        <li><a href="./.././archives/01-01-2016_01-31-2016.html" title="January">January</a></li>
                     
                  
                     <li class="linear-gradient-green">2013</li>
                     
                        <li><a href="./.././archives/02-01-2013_02-28-2013.html" title="February">February</a></li>
                     
                  
                     <li class="linear-gradient-green">2012</li>
                     
                        <li><a href="./.././archives/07-01-2012_07-31-2012.html" title="July">July</a></li>
                     
                  
               </ul>
            </li>
            <li><a href="./.././archives.html" title="About">About</a></li>
         </ul>
      </div>
      <div id="pagination">
         
            
         
         <a href="./.././index.html">Main</a>
         
            
               | <a href="./.././archives/cat_general.html">General &raquo;</a>
            
         
         <div class="clear-all"></div>
      </div>
      <div id="content">
         
            <div id="entry" class="border-shadow-blue">
               <div class="entry-date border-shadow-blue">
                  <div class="entry-date-month">Feb</div>
                  <div class="entry-date-day">24</div>
               </div>
               <h2 class="entry-title"><a href="./.././archives/preventing-the-same-script-from-running-at-the-same-time.html" rel="bookmark">Preventing the same script from running at the same time.</a></h2>
               <div class="entry-description"></div>
               <hr class="linear-gradient-blue" />
               <div class="entry-body">Scheduling scripts as cron jobs can be a guessing game.&#160; Schedule the 
    script to run too closely together e.g. every minute and it can step on 
    itself.&#160; Schedule it too far apart e.g. every hour and it will not perform 
    what it is intended to.<br><br>The answer is a PID file.&#160; A PID file is a 
    file containing the Linux <a href="http://en.wikipedia.org/wiki/Process_identifier" target="_blank">process 
    identification number (pid)</a> for the current running script.<br><br>By 
    using the PID file a job can be scheduled to run every minute but will 
    only execute if it is not already running.<br><br>

    <blockquote>
      export MAILNAME=`echo &quot;${HOSTNAME}&quot; | cut -d '.' -f 1`<br>export 
      MAILUSER=RusticCoder<br>export MAILHOST=GMail.com<br>export 
      MAIL=${MAILUSER}@${MAILHOST}<br>export EMAIL=${MAILUSER}@${MAILHOST}<br>export 
      REPLYTO=${MAILUSER}@${MAILHOST}<br><br>SCRIPT_NAME=`basename &quot;${0}&quot; .sh`<br>LOG_DIR=&quot;~/logs&quot;<br>PID_FILE=&quot;${LOG_DIR}/${SCRIPT_NAME}.pid&quot;<br><br>mkdir 
      -p &quot;${LOG_DIR}&quot;<br><br>if [ -f &quot;${PID_FILE}&quot; ]; then<br>&#160;&#160; 
      OLD_PID=`cat &quot;${PID_FILE}&quot;`<br>&#160;&#160; IS_RUNNING=`ps ax | grep 
      &quot;${OLD_PID}&quot; | grep &quot;${SCRIPT_NAME}&quot;`<br><br>&#160;&#160; if [ 
      -n &quot;${IS_RUNNING}&quot; ]; then<br>&#160;&#160;&#160;&#160;&#160; echo &quot;`date +'%Y-%m-%d 
      %H:%M:%S'` ${SCRIPT_NAME} (Exception): Currently running.&quot;<br>&#160;&#160; 
      else<br>&#160;&#160;&#160;&#160;&#160; echo &quot;`date +'%Y-%m-%d %H:%M:%S'` ${SCRIPT_NAME}: Not 
      running remove the PID file.&quot;<br>&#160;&#160;&#160;&#160;&#160; rm -f &quot;${PID_FILE}&quot;<br>&#160;&#160; 
      fi<br>fi<br><br>if [ -f &quot;${PID_FILE}&quot; ]; then<br>&#160;&#160; if [ `find 
      &quot;${PID_FILE}&quot; -mmin +30` ]; then<br>&#160;&#160;&#160;&#160;&#160; echo &quot;${0} on 
      ${HOSTNAME} has been running longer then 30 minutes.&quot; | mail -s 
      &quot;`basename \&quot;${0}\&quot;` still running&quot; &quot;${EMAIL}&quot; -- -F &quot;${MAILNAME}&quot; -f 
      &quot;${REPLYTO}&quot;<br>&#160;&#160; fi<br>else<br>&#160;&#160; CURRENT_PID=$$<br><br>&#160;&#160; 
      echo ${CURRENT_PID} &gt; &quot;${PID_FILE}&quot;<br><br>&#160;&#160;<br>&#160;&#160; 
      &lt;Perform processing here&gt;<br><br><br>&#160;&#160; if [ -f &quot;${PID_FILE}&quot; ]; 
      then<br>&#160;&#160;&#160;&#160;&#160; rm -f &quot;${PID_FILE}&quot;<br>&#160;&#160; 
      fi<br>fi
    </blockquote>
    I start by checking if the PID file exists.&#160; Even if the file exists the 
    process may have been killed.&#160; If the process has been killed just remove 
    the file.&#160; Then I check again if the file exists and if it has been 
    running for longer then 30 minutes I let myself know.&#160; Otherwise I create 
    a PID file, do what I need to do, and remove the file.</div>
               <div class="entry-author">Posted by <a href="http://rusticcoder.github.io/">Rustic Coder</a> at 11:22 AM</div>
               <hr class="linear-gradient-blue" />
               <div class="entry-categories"><span class="entry-categories-title">Categories:</span> <span id="entry-categories-detail"><a href="./.././archives/cat_bash-scripting.html">Bash-Scripting</a></span></div>
               <div class="clear-all"></div>
               <div class="entry-keywords"><span class="entry-keywords-title">Keywords:</span> <span id="entry-keywords-detail"></span></div>
               <div class="clear-all"></div>
               <div class="entry-labels"><span class="entry-labels-title">Labels:</span> <span id="entry-labels-detail"></span></div>
               <div class="clear-all"></div>
            </div>
         
            <div id="entry" class="border-shadow-blue">
               <div class="entry-date border-shadow-blue">
                  <div class="entry-date-month">Feb</div>
                  <div class="entry-date-day">24</div>
               </div>
               <h2 class="entry-title"><a href="./.././archives/when-to-use-variables.html" rel="bookmark">When to use variables</a></h2>
               <div class="entry-description"></div>
               <hr class="linear-gradient-blue" />
               <div class="entry-body">Using variables in scripts is often a case of personal style.&#160; Years ago 
    the style I used was to declare all variables at the top of a script.&#160; I 
    found that challenging with long scripts.&#160; Needing to scroll up and down 
    to see what the variable is set to.&#160; And while maintaining the script the 
    value could be changed by another developer not realizing the impact 
    further down the script.<br><br>Lately the style I use is to declare and 
    set the variable close to where it is being used.&#160; I upper case with 
    underscore variables that are not to be changed aka constants.&#160; I camel 
    case with a initial upper case variables that are meant to change during 
    the course of the script.<br>

    <blockquote>
      SCRIPT_NAME=`basename &quot;${0}&quot; .sh`<br>CURRENT_DATE=`date 
      +'%Y%m%d'`<br>LOG_DIR=&quot;~/logs&quot;<br>LOG_FILE=&quot;${LOG_DIR}/${SCRIPT_NAME}_${CURRENT_DATE}.log&quot;<br>ERROR_FILE=&quot;${LOG_DIR}/${SCRIPT_NAME}_${CURRENT_DATE}.err&quot;<br><br>ItemIndex=0
    </blockquote>
    Another personal style is to always use curly braces around variables.&#160; I 
    find reading the following $SCRIPT_NAME_$CURRENT_DATE.err looks to me like 
    .err is a method without parameters and the under score before the dollar 
    sign does not stand out.&#160; For me ${SCRIPT_NAME}_${CURRENT_DATE}.err is 
    just easier to read.</div>
               <div class="entry-author">Posted by <a href="http://rusticcoder.github.io/">Rustic Coder</a> at 10:18 AM</div>
               <hr class="linear-gradient-blue" />
               <div class="entry-categories"><span class="entry-categories-title">Categories:</span> <span id="entry-categories-detail"><a href="./.././archives/cat_bash-scripting.html">Bash-Scripting</a></span></div>
               <div class="clear-all"></div>
               <div class="entry-keywords"><span class="entry-keywords-title">Keywords:</span> <span id="entry-keywords-detail"></span></div>
               <div class="clear-all"></div>
               <div class="entry-labels"><span class="entry-labels-title">Labels:</span> <span id="entry-labels-detail"></span></div>
               <div class="clear-all"></div>
            </div>
         
            <div id="entry" class="border-shadow-blue">
               <div class="entry-date border-shadow-blue">
                  <div class="entry-date-month">Feb</div>
                  <div class="entry-date-day">24</div>
               </div>
               <h2 class="entry-title"><a href="./.././archives/running-scripts-as-cron-jobs.html" rel="bookmark">Running scripts as cron jobs</a></h2>
               <div class="entry-description"></div>
               <hr class="linear-gradient-blue" />
               <div class="entry-body">Just a little note.&#160; When you run a cron job under a user the 
    .bash_profile for that user does not always get executed.&#160; This can cause 
    different results when running the script from the command line and as a 
    scheduled job.&#160; The following snippet can even the playing field.<br>

    <blockquote>
      # Even the playing field between cron jobs and command line<br>if [ -f 
      ~/.bash_profile ]; then<br>&#160;&#160; . ~/.bash_profile<br>fi
    </blockquote></div>
               <div class="entry-author">Posted by <a href="http://rusticcoder.github.io/">Rustic Coder</a> at 9:16 AM</div>
               <hr class="linear-gradient-blue" />
               <div class="entry-categories"><span class="entry-categories-title">Categories:</span> <span id="entry-categories-detail"><a href="./.././archives/cat_bash-scripting.html">Bash-Scripting</a></span></div>
               <div class="clear-all"></div>
               <div class="entry-keywords"><span class="entry-keywords-title">Keywords:</span> <span id="entry-keywords-detail"></span></div>
               <div class="clear-all"></div>
               <div class="entry-labels"><span class="entry-labels-title">Labels:</span> <span id="entry-labels-detail"></span></div>
               <div class="clear-all"></div>
            </div>
         
      </div>
      <div id="footer" class="footer-text border-shadow-red">
         <div>Copyright &copy; 2016 Embracing the Challenges of Technology <a href="#" class="footer-text" style="float: right;">Top</a></div>
         <div class="clear-all"></div>
      </div>
   </div>
   <div id="header-mask"></div>
</body>
</html>
