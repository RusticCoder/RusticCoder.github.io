<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "//www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="//www.w3.org/1999/xhtml" itemscope itemtype="//schema.org/Blog">
<head>
   <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
   
      
      
   
   <title>Embracing the Challenges of Technology - Preventing the same script from running at the same time.</title>
   <link rel="apple-touch-icon" sizes="57x57" href="./../apple-touch-icon-57x57.png">
   <link rel="apple-touch-icon" sizes="60x60" href="./../apple-touch-icon-60x60.png">
   <link rel="apple-touch-icon" sizes="72x72" href="./../apple-touch-icon-72x72.png">
   <link rel="apple-touch-icon" sizes="76x76" href="./../apple-touch-icon-76x76.png">
   <link rel="apple-touch-icon" sizes="114x114" href="./../apple-touch-icon-114x114.png">
   <link rel="apple-touch-icon" sizes="120x120" href="./../apple-touch-icon-120x120.png">
   <link rel="apple-touch-icon" sizes="144x144" href="./../apple-touch-icon-144x144.png">
   <link rel="apple-touch-icon" sizes="152x152" href="./../apple-touch-icon-152x152.png">
   <link rel="apple-touch-icon" sizes="180x180" href="./../apple-touch-icon-180x180.png">
   <link rel="icon" type="image/png" href="./../favicon-32x32.png" sizes="32x32">
   <link rel="icon" type="image/png" href="./../android-chrome-192x192.png" sizes="192x192">
   <link rel="icon" type="image/png" href="./../favicon-96x96.png" sizes="96x96">
   <link rel="icon" type="image/png" href="./../favicon-16x16.png" sizes="16x16">
   <link rel="icon" type="image/x-icon" href="./../favicon.ico" />
   <link rel="manifest" href="./../manifest.json">
   <link rel="mask-icon" href="./../safari-pinned-tab.svg" color="#5bbad5">
   <meta name="msapplication-TileColor" content="#da532c">
   <meta name="msapplication-TileImage" content="/mstile-144x144.png">
   <meta name="theme-color" content="#ffffff">
   <meta itemprop="name" content="Embracing the Challenges of Technology">
   <meta itemprop="image" content="//rusticcoder.github.io/images/photo.jpg">
   <link rel="canonical" href="./../" />
   <link type="application/rss+xml" rel="alternate" title="RSS 2.0 - all posts" href="./.././rss.xml" />
   <link rel="me" href="//plus.google.com/110121544309331268618" />
   <style type="text/css" media="screen">@import url( ./../css/style.css );</style>
   <script src="./../js/blog.js"></script>
   <script src="//apis.google.com/js/platform.js" async defer></script>
   <script src="//platform.linkedin.com/in.js">lang: en_US</script>
</head>
<body id="entry-template">
   <div id="fb-root"></div>
   <script>(function(d, s, id) {
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) return;
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));</script>
   <div id="page">
      <div id="header">
         <h1><a href="./.././index.html">Embracing the Challenges of Technology</a></h1>
         <h2></h2>
      </div>
      <div id="nav" class="border-shadow-yellow">
         <ul>
            <li><a href="./.././index.html" title="Home">Home</a></li>
            <li><a href="#">Recent Posts</a>
               <ul class="border-shadow-green fallback">
                  
                     <li><a href="./.././archives/preventing-the-same-script-from-running-at-the-same-time.html">Preventing the same script from running at the same time.</a></li>
                  
               </ul>
            </li>
            <li><a href="#">Category</a>
               <ul class="border-shadow-green fallback">
                  
                     <li><a href="./.././archives/cat_bash-scripting.html" title="Bash-Scripting">Bash-Scripting</a></li>
                  
                     <li><a href="./.././archives/cat_general.html" title="General">General</a></li>
                  
                     <li><a href="./.././archives/cat_haskell.html" title="Haskell">Haskell</a></li>
                  
                     <li><a href="./.././archives/cat_quotes.html" title="Quotes">Quotes</a></li>
                  
                     <li><a href="./.././archives/cat_rust.html" title="Rust">Rust</a></li>
                  
                     <li><a href="./.././archives/cat_softwaredesign.html" title="Software Design">Software Design</a></li>
                  
                     <li><a href="./.././archives/cat_softwaredevelopment.html" title="Software Development">Software Development</a></li>
                  
                     <li><a href="./.././archives/cat_softwaretesting.html" title="Software Testing">Software Testing</a></li>
                  
               </ul>
            </li>
            <li><a href="#">Archives</a>
               <ul class="border-shadow-green fallback">
                  
                     <li class="linear-gradient-green">2016</li>
                     
                        <li><a href="./.././archives/01-01-2016_01-31-2016.html" title="January">January</a></li>
                     
                  
                     <li class="linear-gradient-green">2013</li>
                     
                        <li><a href="./.././archives/02-01-2013_02-28-2013.html" title="February">February</a></li>
                     
                  
                     <li class="linear-gradient-green">2012</li>
                     
                        <li><a href="./.././archives/07-01-2012_07-31-2012.html" title="July">July</a></li>
                     
                  
               </ul>
            </li>
            <li><a href="./.././archives.html" title="About">About</a></li>
         </ul>
         <div id="twitter-follow-button" class="hide-til-load">
            <a href="//twitter.com/RusticCoder" class="twitter-follow-button" data-show-count="false">Follow @RusticCoder</a>
            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^https:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src='//platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
         </div>
      </div>
      <div id="pagination">
         
            
               <a href="./.././archives/bash-script-logging.html">&laquo; Bash Script Logging</a> |
            
         
         <a href="./.././index.html">Main</a>
         
            
               | <a href="./.././archives/commenting-and-documenting-code.html">Commenting and Documenting Code &raquo;</a>
            
         
         <div class="clear-all"></div>
      </div>
      <div id="content">
         
            <div id="entry" class="border-shadow-blue">
               <div class="entry-date">
                  <div style="padding-bottom: 4px;">Sunday, 24 February, 2013</div>
                  <div class="hide-til-load entry-social-top"><span id="instapaper"><a href="//www.instapaper.com/hello2?url=https://rusticcoder.github.io/./archives/preventing-the-same-script-from-running-at-the-same-time.html&amp;title=Preventing the same script from running at the same time." title="Preventing the same script from running at the same time." target="_blank">[Read later]</a></span> <a href="//twitter.com/share" class="twitter-share-button"{count} data-url="//rusticcoder.github.io/./archives/preventing-the-same-script-from-running-at-the-same-time.html" data-text="Preventing the same script from running at the same time." data-via="RusticCoder">Tweet</a></div>
                  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^https:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src='//platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
               </div>
               <h2 class="entry-title" itemprop="name"><a href="./.././archives/preventing-the-same-script-from-running-at-the-same-time.html" rel="bookmark">Preventing the same script from running at the same time.</a></h2>
               <div class="entry-description" itemprop="description"></div>
               <div class="clear-all"></div>
               <hr class="linear-gradient-blue" />
               <div class="entry-body">Scheduling scripts as cron jobs can be a guessing game.&#160; Schedule the 
    script to run too closely together e.g. every minute and it can step on 
    itself.&#160; Schedule it too far apart e.g. every hour and it will not perform 
    what it is intended to.<br><br>The answer is a PID file.&#160; A PID file is a 
    file containing the Linux <a href="http://en.wikipedia.org/wiki/Process_identifier" target="_blank">process 
    identification number (pid)</a> for the current running script.<br><br>By 
    using the PID file a job can be scheduled to run every minute but will 
    only execute if it is not already running.<br><br>

    <blockquote>
      export MAILNAME=`echo &quot;${HOSTNAME}&quot; | cut -d '.' -f 1`<br>export 
      MAILUSER=RusticCoder<br>export MAILHOST=GMail.com<br>export 
      MAIL=${MAILUSER}@${MAILHOST}<br>export EMAIL=${MAILUSER}@${MAILHOST}<br>export 
      REPLYTO=${MAILUSER}@${MAILHOST}<br><br>SCRIPT_NAME=`basename &quot;${0}&quot; .sh`<br>LOG_DIR=&quot;~/logs&quot;<br>PID_FILE=&quot;${LOG_DIR}/${SCRIPT_NAME}.pid&quot;<br><br>mkdir 
      -p &quot;${LOG_DIR}&quot;<br><br>if [ -f &quot;${PID_FILE}&quot; ]; then<br>&#160;&#160; 
      OLD_PID=`cat &quot;${PID_FILE}&quot;`<br>&#160;&#160; IS_RUNNING=`ps ax | grep 
      &quot;${OLD_PID}&quot; | grep &quot;${SCRIPT_NAME}&quot;`<br><br>&#160;&#160; if [ 
      -n &quot;${IS_RUNNING}&quot; ]; then<br>&#160;&#160;&#160;&#160;&#160; echo &quot;`date +'%Y-%m-%d 
      %H:%M:%S'` ${SCRIPT_NAME} (Exception): Currently running.&quot;<br>&#160;&#160; 
      else<br>&#160;&#160;&#160;&#160;&#160; echo &quot;`date +'%Y-%m-%d %H:%M:%S'` ${SCRIPT_NAME}: Not 
      running remove the PID file.&quot;<br>&#160;&#160;&#160;&#160;&#160; rm -f &quot;${PID_FILE}&quot;<br>&#160;&#160; 
      fi<br>fi<br><br>if [ -f &quot;${PID_FILE}&quot; ]; then<br>&#160;&#160; if [ `find 
      &quot;${PID_FILE}&quot; -mmin +30` ]; then<br>&#160;&#160;&#160;&#160;&#160; echo &quot;${0} on 
      ${HOSTNAME} has been running longer then 30 minutes.&quot; | mail -s 
      &quot;`basename \&quot;${0}\&quot;` still running&quot; &quot;${EMAIL}&quot; -- -F &quot;${MAILNAME}&quot; -f 
      &quot;${REPLYTO}&quot;<br>&#160;&#160; fi<br>else<br>&#160;&#160; CURRENT_PID=$$<br><br>&#160;&#160; 
      echo ${CURRENT_PID} &gt; &quot;${PID_FILE}&quot;<br><br>&#160;&#160;<br>&#160;&#160; 
      &lt;Perform processing here&gt;<br><br><br>&#160;&#160; if [ -f &quot;${PID_FILE}&quot; ]; 
      then<br>&#160;&#160;&#160;&#160;&#160; rm -f &quot;${PID_FILE}&quot;<br>&#160;&#160; 
      fi<br>fi
    </blockquote>
    I start by checking if the PID file exists.&#160; Even if the file exists the 
    process may have been killed.&#160; If the process has been killed just remove 
    the file.&#160; Then I check again if the file exists and if it has been 
    running for longer then 30 minutes I let myself know.&#160; Otherwise I create 
    a PID file, do what I need to do, and remove the file.</div>
               <div class="entry-author">Posted by <a href="http://rusticcoder.github.io/">Rustic Coder</a> at 11:22 AM</div>
               <div class="clear-all"></div>
               <hr class="linear-gradient-blue" />
               <div id="disqus_thread"></div>
               <script>
                  var disqus_config = function () {
                     this.page.url = "https://rusticcoder.github.io/./archives/preventing-the-same-script-from-running-at-the-same-time.html";
                     this.page.identifier = "./archives/preventing-the-same-script-from-running-at-the-same-time.html";
                  };

                  (function() { // DON'T EDIT BELOW THIS LINE
                     var d = document, s = d.createElement('script');

                     s.src = '//rusticcoder-github-io.disqus.com/embed.js';

                     s.setAttribute('data-timestamp', +new Date());
                     (d.head || d.body).appendChild(s);
                  })();
               </script>
               <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus</a>.</noscript>
               <div class="clear-all"></div>
               <hr class="linear-gradient-blue" />
               <div class="hide-til-load entry-social-bottom">
                  <span id="facebook">
                     <div class="fb-share-button" data-href="//rusticcoder.github.io/./archives/preventing-the-same-script-from-running-at-the-same-time.html" data-layout="icon"></div>
                  </span>
                  <span id="google_plus">
                     <div class="g-plusone" data-annotation="none" data-size="medium" data-width="300" data-href="//rusticcoder.github.io/./archives/preventing-the-same-script-from-running-at-the-same-time.html"></div>
                  </span>
                  <span id="linkedin">
                     <script type="IN/Share" data-url="//rusticcoder.github.io/./archives/preventing-the-same-script-from-running-at-the-same-time.html"></script>
                  </span>
                  <span id="reddit">
                     <script type="text/javascript">
                       reddit_url="//rusticcoder.github.io/./archives/preventing-the-same-script-from-running-at-the-same-time.html";
                       reddit_title="Preventing the same script from running at the same time.";
                       reddit_bgcolor="rgba(240, 240, 240, 1.0)";
                       reddit_bordercolor="rgba(16, 16, 16, 1.0)";
                       reddit_newwindow='1';
                     </script>
                     <script type="text/javascript" src="//www.redditstatic.com/button/button1.js"></script>
                  </span>
                  <span id="ycombinator">
                     <a href="//news.ycombinator.com/submitlink?u=https://rusticcoder.github.io/./archives/preventing-the-same-script-from-running-at-the-same-time.html&amp;t=Preventing the same script from running at the same time." target="_blank"><img src="//news.ycombinator.com/y18.gif" title="Submit 'Preventing the same script from running at the same time.' to Hacker News" height="22px"></a>
                  </span>
                  <span id="email">
                     <a href="mailto:?subject=Preventing the same script from running at the same time.&amp;body=https://rusticcoder.github.io/./archives/preventing-the-same-script-from-running-at-the-same-time.html" target="_blank"><img src="./../images/mail21.png"></a>
                  </span>
                  <div class="entry-categories"><span class="entry-categories-title">Categories:</span> <span id="entry-categories-detail"><a href="./.././archives/cat_bash-scripting.html">Bash-Scripting</a></span></div>
               </div>
               <div class="clear-all"></div>
               <div class="entry-keywords"><span class="entry-keywords-title">Keywords:</span> <span id="entry-keywords-detail"></span></div>
               <div class="clear-all"></div>
               <div class="entry-labels"><span class="entry-labels-title">Labels:</span> <span id="entry-labels-detail"></span></div>
               <div class="clear-all"></div>
            </div>
         
      </div>
      <div id="footer" class="footer-text border-shadow-red">
         <div>Copyright &copy; 2016 Embracing the Challenges of Technology <div style="float: right;"><a href="//github.com/RusticCoder/RusticCoder.github.io_Feedback/issues/new" target="_blank" class="border-shadow-blue fallback leave-feedback"><img src="./../images/feedback19.png" style="vertical-align: middle;"> Leave Feedback</a> <a href="#" class="footer-text">Top</a></div></div>
         <div class="clear-all"></div>
      </div>
   </div>
   <div id="header-mask"></div>
   <script id="dsq-count-scr" src="//rusticcoder-github-io.disqus.com/count.js" async></script>
   <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-72718412-1', 'auto');
      ga('send', 'pageview');
   </script>
</body>
</html>
